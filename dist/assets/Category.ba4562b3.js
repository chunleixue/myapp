var e=Object.defineProperty,a=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,l=Object.prototype.propertyIsEnumerable,r=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,o=(e,o)=>{for(var n in o||(o={}))a.call(o,n)&&r(e,n,o[n]);if(t)for(var n of t(o))l.call(o,n)&&r(e,n,o[n]);return e};import{h as n}from"./index.76206f03.js";import{Z as d,a3 as i,r as c,t as s,_ as u,b as p,e as g,f as m,g as y,a9 as f,h,k as v,u as b,o as C,l as k,p as _,d as I,a6 as F,a7 as w,a8 as S,w as P}from"./vendor.0469baee.js";const x={name:"DialogAddCategory",props:{type:String,reload:Function},setup(e){const a=d(null),t=i(),l=c({visible:!1,categoryLevel:1,parentId:0,ruleForm:{name:"",rank:""},rules:{name:[{required:"true",message:"名称不能为空",trigger:["change"]}],rank:[{required:"true",message:"编号不能为空",trigger:["change"]}]},id:""});return o(o({},s(l)),{open:e=>{if(l.visible=!0,e)l.id=e,(e=>{p.get(`/categories/${e}`).then((e=>{l.ruleForm={name:e.categoryName,rank:e.categoryRank},l.parentId=e.parentId,l.categoryLevel=e.categoryLevel}))})(e);else{const{level:e=1,parent_id:a=0}=t.query;l.ruleForm={name:"",rank:""},l.parentId=a,l.categoryLevel=e}},close:()=>{l.visible=!1},formRef:a,submitForm:()=>{a.value.validate((a=>{if(a){if(n(l.ruleForm.name))return void u.error("不要输入表情包，再输入就打死你个龟孙儿~");"add"==e.type?p.post("/categories",{categoryLevel:l.categoryLevel,parentId:l.parentId,categoryName:l.ruleForm.name,categoryRank:l.ruleForm.rank}).then((()=>{u.success("添加成功"),l.visible=!1,e.reload&&e.reload()})):p.put("/categories",{categoryId:l.id,categoryLevel:l.categoryLevel,parentId:l.parentId,categoryName:l.ruleForm.name,categoryRank:l.ruleForm.rank}).then((()=>{u.success("修改成功"),l.visible=!1,e.reload&&e.reload()}))}}))}})}},D={class:"dialog-footer"},L=v("取 消"),V=v("确 定");x.render=function(e,a,t,l,r,o){const n=g("el-input"),d=g("el-form-item"),i=g("el-form"),c=g("el-button"),s=g("el-dialog");return m(),y(s,{title:"add"==t.type?"添加分类":"修改分类",modelValue:e.visible,"onUpdate:modelValue":a[4]||(a[4]=a=>e.visible=a),width:"400px"},{footer:f((()=>[h("span",D,[h(c,{onClick:a[3]||(a[3]=a=>e.visible=!1)},{default:f((()=>[L])),_:1}),h(c,{type:"primary",onClick:l.submitForm},{default:f((()=>[V])),_:1},8,["onClick"])])])),default:f((()=>[h(i,{model:e.ruleForm,rules:e.rules,ref:"formRef","label-width":"100px",class:"good-form"},{default:f((()=>[h(d,{label:"商品名称",prop:"name"},{default:f((()=>[h(n,{type:"text",modelValue:e.ruleForm.name,"onUpdate:modelValue":a[1]||(a[1]=a=>e.ruleForm.name=a)},null,8,["modelValue"])])),_:1}),h(d,{label:"排序值",prop:"rank"},{default:f((()=>[h(n,{type:"number",modelValue:e.ruleForm.rank,"onUpdate:modelValue":a[2]||(a[2]=a=>e.ruleForm.rank=a)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])};const z={name:"Category",components:{DialogAddCategory:x},setup(){const e=d(null),a=d(null),t=b(),l=i(),r=c({loading:!1,tableData:[],multipleSelection:[],total:0,currentPage:1,pageSize:10,type:"add",level:1,parent_id:0});C((()=>{g()})),k((()=>{n()}));const n=t.afterEach((e=>{["category","level2","level3"].includes(e.name)&&g()})),g=()=>{const{level:e=1,parent_id:a=0}=l.query;r.loading=!0,p.get("/categories",{params:{pageNumber:r.currentPage,pageSize:r.pageSize,categoryLevel:e,parentId:a}}).then((t=>{r.tableData=t.list,r.total=t.totalCount,r.currentPage=t.currPage,r.loading=!1,r.level=e,r.parentId=a}))};return o(o({},s(r)),{multipleTable:e,handleSelectionChange:e=>{r.multipleSelection=e},addGood:a,handleAdd:()=>{r.type="add",a.value.open()},handleEdit:e=>{r.type="edit",a.value.open(e)},handleDelete:()=>{r.multipleSelection.length?p.delete("/categories",{data:{ids:r.multipleSelection.map((e=>e.categoryId))}}).then((()=>{u.success("删除成功"),g()})):u.error("请选择项")},handleDeleteOne:e=>{p.delete("/categories",{data:{ids:[e]}}).then((()=>{u.success("删除成功"),g()}))},getCategory:g,changePage:e=>{r.currentPage=e,g()},handleNext:e=>{const a=e.categoryLevel+1;4!=a?t.push({name:`level${a}`,query:{level:a,parent_id:e.categoryId}}):u.error("没有下一级")}})}},O=P();_("data-v-4d5aa038");const N={class:"header"},j=v("增加"),R=v("批量删除"),q=h("a",{style:{cursor:"pointer"}},"删除",-1);I();const A=O(((e,a,t,l,r,o)=>{const n=g("el-button"),d=g("el-popconfirm"),i=g("el-table-column"),c=g("el-table"),s=g("el-pagination"),u=g("el-card"),p=g("DialogAddCategory"),f=F("loading");return m(),y(S,null,[h(u,{class:"category-container"},{header:O((()=>[h("div",N,[h(n,{type:"primary",size:"small",icon:"el-icon-plus",onClick:l.handleAdd},{default:O((()=>[j])),_:1},8,["onClick"]),h(d,{title:"确定删除吗？",onConfirm:l.handleDelete},{reference:O((()=>[h(n,{type:"danger",size:"small",icon:"el-icon-delete"},{default:O((()=>[R])),_:1})])),_:1},8,["onConfirm"])])])),default:O((()=>[w(h(c,{ref:"multipleTable",data:e.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:l.handleSelectionChange},{default:O((()=>[h(i,{type:"selection",width:"55"}),h(i,{prop:"categoryName",label:"分类名称"}),h(i,{prop:"categoryRank",label:"排序值",width:"120"}),h(i,{prop:"createTime",label:"添加时间",width:"200"}),h(i,{label:"操作",width:"220"},{default:O((e=>[h("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:a=>l.handleEdit(e.row.categoryId)},"修改",8,["onClick"]),h("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:a=>l.handleNext(e.row)},"下级分类",8,["onClick"]),h(d,{title:"确定删除吗？",onConfirm:a=>l.handleDeleteOne(e.row.categoryId)},{reference:O((()=>[q])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data","onSelectionChange"]),[[f,e.loading]]),h(s,{background:"",layout:"prev, pager, next",total:e.total,"page-size":e.pageSize,"current-page":e.currentPage,onCurrentChange:l.changePage},null,8,["total","page-size","current-page","onCurrentChange"])])),_:1}),h(p,{ref:"addGood",reload:l.getCategory,type:e.type,level:e.level,parent_id:e.parent_id},null,8,["reload","type","level","parent_id"])],64)}));z.render=A,z.__scopeId="data-v-4d5aa038";export default z;
